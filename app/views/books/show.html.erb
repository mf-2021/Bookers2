<main>
  <p id="notice"></p>
  <div class="container px-5 px-sm-0">
    <div class="row">
      <div class="col-md-3">

        <%# Userinfo部分テンプレート %>
        <%= render "users/userinfo", user: @user %>

        <%# Newbook部分テンプレート %>
        <%= render "books/form", book: @book %>

      </div>

      <div class="col-md-8 offset-md-1">
        <h2>Book detail</h2>
        <table class="table">
          <tbody>
            <tr>
              <td>
                <%= attachment_image_tag @user, :profile_image, :fill, size: "40x40", format:"jpeg", fallback: "no_image.jpg" %><br>
                <%= link_to @user.name, user_path(@user) %>
              </td>
              <td>
                <%= link_to @showbook.title, book_path(@showbook) %>
              </td>
              <td>
                <%= @showbook.body %>
              </td>
              <td>
                <!--イイねを挿入-->
                <% if @showbook.favorited_by?(current_user) %>
                  <%= link_to book_favorites_path(@showbook), method: :delete do %>
                    ♥<%= @showbook.favorites.count %>
                  <% end %>
                <% else %>
                  <%= link_to book_favorites_path(@showbook), method: :post do %>
                    ♡<%= @showbook.favorites.count %>
                  <% end %>
                <% end %>
              </td>
              <td>
              <% if @user.id == current_user.id %>
                <%= link_to "Edit", edit_book_path(@showbook), class:"btn btn-sm btn-success" %>
              <% end %>
              </td>
              <td>
              <% if @user.id == current_user.id %>
                <%= link_to "Destroy", book_path(@showbook.id), method: :delete, class: "btn btn-sm btn-danger", "data-confirm"=>"Are you sure?" %>
              <% end %>
              </td>
              <td>
                <P>
                コメント数：<%= @showbook.book_comments.count %>
                </P>
              </td>
            </tr>
          </tbody>
        </table>
        <!--comment box-->
        <table>
          <tbody>
            <!--@showbook（bookモデル）に結びつけられているpost_commentsテーブルの各カラムのデータをブロック変数であるbook_commentに代入-->
            <% @showbook.book_comments.each do |book_comment| %>
            <tr>
              <td>
                <%= attachment_image_tag @comment_user, :profile_image, :fill, size: "40x40", format: "jpeg", fallback: "no_image.jpg" %><br>
                <%= link_to book_comment.user.name, user_path(@comment_user) %>
              </td>
              <td>
                <p><%= book_comment.comment %></p>
              </td>
              <td>
                <% if book_comment.user == current_user %>
                  <div class="comment-delete">
                    <%= link_to "Destroy", book_book_comment_path(book_comment.book, book_comment), method: :delete, class: "btn btn-sm btn-danger" %>
                  </div>
                <% end %>
              </td>
              <% end %>
              </td>
            </tr>
          </tbody>
        </table>

        <!--new comment-->
        <div class="new-comment">
              <%= form_with(model:[@showbook, @book_comment], lacal: true) do |f| %>
                <%= f.text_area :comment, rows:'5', class: "form-control" %>
                <%= f.submit "送信" %>
              <% end %>
            </div>
      </div>
    </div>
  </div>
</main>
